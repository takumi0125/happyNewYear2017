!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.WebVRManager=e()}}(function(){return function e(t,i,n){function o(r,a){if(!i[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};t[r][0].call(u.exports,function(e){var i=t[r][1][e];return o(i?i:e)},u,u.exports,e,t,i,n)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,i){function n(e){var t=e||document.body;this.loadIcons_();var i=this.createButton();i.src=this.ICONS.fullscreen,i.title="Fullscreen mode";var n=i.style;n.bottom=0,n.right=0,i.addEventListener("click",this.createClickHandler_("fs")),t.appendChild(i),this.fsButton=i;var o=this.createButton();o.src=this.ICONS.cardboard,o.title="Virtual reality mode";var n=o.style;n.bottom=0,n.right="48px",o.addEventListener("click",this.createClickHandler_("vr")),t.appendChild(o),this.vrButton=o,this.isVisible=!0}var o=e("./emitter.js"),s=e("./modes.js"),r=e("./util.js");n.prototype=new o,n.prototype.createButton=function(){var e=document.createElement("img");e.className="webvr-button";var t=e.style;return t.position="absolute",t.width="24px",t.height="24px",t.backgroundSize="cover",t.backgroundColor="transparent",t.border=0,t.userSelect="none",t.webkitUserSelect="none",t.MozUserSelect="none",t.cursor="pointer",t.padding="12px",t.zIndex=1,t.display="none",t.boxSizing="content-box",e.draggable=!1,e.addEventListener("dragstart",function(e){e.preventDefault()}),e.addEventListener("mouseenter",function(e){t.filter=t.webkitFilter="drop-shadow(0 0 5px rgba(255,255,255,1))"}),e.addEventListener("mouseleave",function(e){t.filter=t.webkitFilter=""}),e},n.prototype.setMode=function(e,t){if(t=t||WebVRConfig.FORCE_ENABLE_VR,this.isVisible){switch(e){case s.NORMAL:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.fullscreen,this.vrButton.style.display=t?"block":"none";break;case s.MAGIC_WINDOW:this.fsButton.style.display="block",this.fsButton.src=this.ICONS.exitFullscreen,this.vrButton.style.display="none";break;case s.VR:this.fsButton.style.display="none",this.vrButton.style.display="none"}var i=this.fsButton.style.display;this.fsButton.style.display="inline-block",this.fsButton.offsetHeight,this.fsButton.style.display=i}},n.prototype.setVisibility=function(e){this.isVisible=e,this.fsButton.style.display=e?"block":"none",this.vrButton.style.display=e?"block":"none"},n.prototype.createClickHandler_=function(e){return function(t){t.stopPropagation(),t.preventDefault(),this.emit(e)}.bind(this)},n.prototype.loadIcons_=function(){this.ICONS={},this.ICONS.cardboard=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMjAuNzQgNkgzLjIxQzIuNTUgNiAyIDYuNTcgMiA3LjI4djEwLjQ0YzAgLjcuNTUgMS4yOCAxLjIzIDEuMjhoNC43OWMuNTIgMCAuOTYtLjMzIDEuMTQtLjc5bDEuNC0zLjQ4Yy4yMy0uNTkuNzktMS4wMSAxLjQ0LTEuMDFzMS4yMS40MiAxLjQ1IDEuMDFsMS4zOSAzLjQ4Yy4xOS40Ni42My43OSAxLjExLjc5aDQuNzljLjcxIDAgMS4yNi0uNTcgMS4yNi0xLjI4VjcuMjhjMC0uNy0uNTUtMS4yOC0xLjI2LTEuMjh6TTcuNSAxNC42MmMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTMgMS4xOCAwIDIuMTIuOTYgMi4xMiAyLjEzcy0uOTUgMi4xMi0yLjEyIDIuMTJ6bTkgMGMtMS4xNyAwLTIuMTMtLjk1LTIuMTMtMi4xMiAwLTEuMTcuOTYtMi4xMyAyLjEzLTIuMTNzMi4xMi45NiAyLjEyIDIuMTMtLjk1IDIuMTItMi4xMiAyLjEyeiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo="),this.ICONS.fullscreen=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNyAxNEg1djVoNXYtMkg3di0zem0tMi00aDJWN2gzVjVINXY1em0xMiA3aC0zdjJoNXYtNWgtMnYzek0xNCA1djJoM3YzaDJWNWgtNXoiLz4KPC9zdmc+Cg=="),this.ICONS.exitFullscreen=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNNSAxNmgzdjNoMnYtNUg1djJ6bTMtOEg1djJoNVY1SDh2M3ptNiAxMWgydi0zaDN2LTJoLTV2NXptMi0xMVY1aC0ydjVoNVY4aC0zeiIvPgo8L3N2Zz4K"),this.ICONS.settings=r.base64("image/svg+xml","PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iI0ZGRkZGRiI+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+CiAgICA8cGF0aCBkPSJNMTkuNDMgMTIuOThjLjA0LS4zMi4wNy0uNjQuMDctLjk4cy0uMDMtLjY2LS4wNy0uOThsMi4xMS0xLjY1Yy4xOS0uMTUuMjQtLjQyLjEyLS42NGwtMi0zLjQ2Yy0uMTItLjIyLS4zOS0uMy0uNjEtLjIybC0yLjQ5IDFjLS41Mi0uNC0xLjA4LS43My0xLjY5LS45OGwtLjM4LTIuNjVDMTQuNDYgMi4xOCAxNC4yNSAyIDE0IDJoLTRjLS4yNSAwLS40Ni4xOC0uNDkuNDJsLS4zOCAyLjY1Yy0uNjEuMjUtMS4xNy41OS0xLjY5Ljk4bC0yLjQ5LTFjLS4yMy0uMDktLjQ5IDAtLjYxLjIybC0yIDMuNDZjLS4xMy4yMi0uMDcuNDkuMTIuNjRsMi4xMSAxLjY1Yy0uMDQuMzItLjA3LjY1LS4wNy45OHMuMDMuNjYuMDcuOThsLTIuMTEgMS42NWMtLjE5LjE1LS4yNC40Mi0uMTIuNjRsMiAzLjQ2Yy4xMi4yMi4zOS4zLjYxLjIybDIuNDktMWMuNTIuNCAxLjA4LjczIDEuNjkuOThsLjM4IDIuNjVjLjAzLjI0LjI0LjQyLjQ5LjQyaDRjLjI1IDAgLjQ2LS4xOC40OS0uNDJsLjM4LTIuNjVjLjYxLS4yNSAxLjE3LS41OSAxLjY5LS45OGwyLjQ5IDFjLjIzLjA5LjQ5IDAgLjYxLS4yMmwyLTMuNDZjLjEyLS4yMi4wNy0uNDktLjEyLS42NGwtMi4xMS0xLjY1ek0xMiAxNS41Yy0xLjkzIDAtMy41LTEuNTctMy41LTMuNXMxLjU3LTMuNSAzLjUtMy41IDMuNSAxLjU3IDMuNSAzLjUtMS41NyAzLjUtMy41IDMuNXoiLz4KPC9zdmc+Cg==")},t.exports=n},{"./emitter.js":2,"./modes.js":3,"./util.js":4}],2:[function(e,t,i){function n(){this.callbacks={}}n.prototype.emit=function(e){var t=this.callbacks[e];if(t){var i=[].slice.call(arguments);i.shift();for(var n=0;n<t.length;n++)t[n].apply(this,i)}},n.prototype.on=function(e,t){e in this.callbacks?this.callbacks[e].push(t):this.callbacks[e]=[t]},t.exports=n},{}],3:[function(e,t,i){var n={UNKNOWN:0,NORMAL:1,MAGIC_WINDOW:2,VR:3};t.exports=n},{}],4:[function(e,t,i){var n={};n.base64=function(e,t){return"data:"+e+";base64,"+t},n.isMobile=function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},n.isFirefox=function(){return/firefox/i.test(navigator.userAgent)},n.isIOS=function(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)},n.isIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},n.appendQueryParameter=function(e,t,i){var n=e.indexOf("?")<0?"?":"&";return e+=n+t+"="+i},n.getQueryParameter=function(e){var e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},n.isLandscapeMode=function(){return 90==window.orientation||window.orientation==-90},n.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},n.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},t.exports=n},{}],5:[function(e,t,i){function n(e,t,i){this.params=i||{},this.mode=r.UNKNOWN,this.hideButton=this.params.hideButton||!1,this.predistorted=!!this.params.predistorted,this.renderer=e,this.effect=t;var n=document.querySelector(".webvr-polyfill-fullscreen-wrapper");this.button=new o(n),this.isFullscreenDisabled=!!a.getQueryParameter("no_fullscreen"),this.startMode=r.NORMAL;var s=parseInt(a.getQueryParameter("start_mode"));isNaN(s)||(this.startMode=s),this.hideButton&&this.button.setVisibility(!1),this.getDeviceByType_(VRDisplay).then(function(e){switch(this.hmd=e,this.isVRCompatibleOverride||(this.isVRCompatible=!e.isPolyfilled||a.isMobile()),this.startMode){case r.MAGIC_WINDOW:this.setMode_(r.MAGIC_WINDOW);break;case r.VR:this.enterVRMode_(),this.setMode_(r.VR);break;default:this.setMode_(r.NORMAL)}this.emit("initialized")}.bind(this)),this.button.on("fs",this.onFSClick_.bind(this)),this.button.on("vr",this.onVRClick_.bind(this)),document.addEventListener("webkitfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("mozfullscreenchange",this.onFullscreenChange_.bind(this)),document.addEventListener("msfullscreenchange",this.onFullscreenChange_.bind(this)),window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange_.bind(this)),window.addEventListener("vrdisplaydeviceparamschange",this.onVRDisplayDeviceParamsChange_.bind(this))}var o=e("./button-manager.js"),s=e("./emitter.js"),r=e("./modes.js"),a=e("./util.js");n.prototype=new s,n.Modes=r,n.prototype.render=function(e,t,i){e instanceof Array?this.effect.render(e[0],t):this.effect.render(e,t)},n.prototype.setVRCompatibleOverride=function(e){this.isVRCompatible=e,this.isVRCompatibleOverride=!0,this.button.setMode(this.mode,this.isVRCompatible)},n.prototype.setFullscreenCallback=function(e){this.fullscreenCallback=e},n.prototype.setVRCallback=function(e){this.vrCallback=e},n.prototype.setExitFullscreenCallback=function(e){this.exitFullscreenCallback=e},n.prototype.getDeviceByType_=function(e){return new Promise(function(t,i){navigator.getVRDisplays().then(function(i){for(var n=0;n<i.length;n++)if(i[n]instanceof e){t(i[n]);break}t(null)},function(){t(null)})})},n.prototype.enterVRMode_=function(){this.hmd.requestPresent([{source:this.renderer.domElement,predistorted:this.predistorted}])},n.prototype.setMode_=function(e){var t=this.mode;return e==this.mode?void console.warn("Not changing modes, already in %s",e):(this.mode=e,this.button.setMode(e,this.isVRCompatible),void this.emit("modechange",e,t))},n.prototype.onFSClick_=function(){switch(this.mode){case r.NORMAL:if(a.isIOS()&&a.isIFrame()){if(!this.fullscreenCallback){var e=window.location.href;return e=a.appendQueryParameter(e,"no_fullscreen","true"),e=a.appendQueryParameter(e,"start_mode",r.MAGIC_WINDOW),void(top.location.href=e)}this.fullscreenCallback()}this.setMode_(r.MAGIC_WINDOW),this.requestFullscreen_();break;case r.MAGIC_WINDOW:if(this.isFullscreenDisabled)return void window.history.back();this.exitFullscreenCallback&&this.exitFullscreenCallback(),this.setMode_(r.NORMAL),this.exitFullscreen_()}},n.prototype.onVRClick_=function(){if(this.mode==r.NORMAL&&a.isIOS()&&a.isIFrame()){if(!this.vrCallback){var e=window.location.href;return e=a.appendQueryParameter(e,"no_fullscreen","true"),e=a.appendQueryParameter(e,"start_mode",r.VR),void(top.location.href=e)}this.vrCallback()}this.enterVRMode_()},n.prototype.requestFullscreen_=function(){var e=document.body;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},n.prototype.exitFullscreen_=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},n.prototype.onVRDisplayPresentChange_=function(e){console.log("onVRDisplayPresentChange_",e),this.hmd.isPresenting?this.setMode_(r.VR):this.setMode_(r.NORMAL)},n.prototype.onVRDisplayDeviceParamsChange_=function(e){console.log("onVRDisplayDeviceParamsChange_",e)},n.prototype.onFullscreenChange_=function(e){null!==document.webkitFullscreenElement&&null!==document.mozFullScreenElement||this.setMode_(r.NORMAL)},t.exports=n},{"./button-manager.js":1,"./emitter.js":2,"./modes.js":3,"./util.js":4}]},{},[5])(5)});